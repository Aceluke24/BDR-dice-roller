<!DOCTYPE html>
<html>
<head>
    <title>Dice Roller</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .crest-watermark {
            background-image: url("{{ url_for('static', filename='crest.jpg') }}");
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <!-- Heraldic Crest Side Panel -->
        <div class="crest-panel">
            <img src="{{ url_for('static', filename='crest.jpg') }}" alt="Family Crest" class="crest-image">
        </div>
        
        <div class="container">
        <h1>ðŸŽ² Dice Roller</h1>

        <!-- Display match score -->
        {% if match_count > 0 %}
            <div class="base-display">
                Match Score: {{ match_count }}
            </div>
        {% endif %}

        <!-- Initial Roll -->
        <form method="POST" class="roll-form">
            <input
                type="number"
                name="num_dice"
                min="1"
                max="20"
                placeholder="Number of dice"
                required
                value="{{ num_dice }}"
            >
            <button type="submit" name="action" value="roll" class="roll-button">
                Roll Dice
            </button>
        </form>

        <!-- Dice Display (grouped) -->
        {% if grouped_dice %}
            <div class="dice-display-area">
                {% for die_value, dice_images in grouped_dice %}
                    <div class="dice-group">
                        <div class="dice-container">
                            {% for img in dice_images %}
                                <img
                                    src="{{ url_for('static', filename='dice/' + img) }}"
                                    class="dice {% if die_value == base_number %}highlight{% endif %}"
                                    alt="Dice showing {{ die_value }}"
                                >
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <!-- Bonus Roll -->
        {% if can_bonus %}
            <form method="POST">
                <button
                    type="submit"
                    name="action"
                    value="bonus"
                    class="bonus-button"
                >
                    ðŸŽ¯ Roll Bonus Die
                </button>
            </form>
        {% endif %}
    </div>

    <!-- JavaScript to handle Enter key and auto-focus -->
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const numInput = document.querySelector('input[name="num_dice"]');
        const rollButton = document.querySelector('button[name="action"][value="roll"]');

        // Automatically focus the number input
        if (numInput) numInput.focus();

        // Handle Enter key for both initial and bonus rolls
        document.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                e.preventDefault(); // prevent default form submit
                const bonusButton = document.querySelector('.bonus-button');

                if (bonusButton) {
                    bonusButton.click();
                } else if (rollButton) {
                    rollButton.click();
                }

                if (numInput) {
                    numInput.focus();
                    numInput.select();
                }
            }
        });
    });
    </script>
</body>
</html>